---
title: LDScore - Generate ldcts file
execute:
  eval: true
#self-contained: true
code-fold: true
bibliography: references.bib
---

To compute the LDScore regression one needs a file that has a row per genelist (celltype in our case) followed by a space, the path to the scored gene list ending in a `.` (to get all the chromosomes), then a `,` and the path to the background gene list, also ending in a `.`

First I'll save the full system path on Hawk to the .ldscore.gz files to a text file to manipulate.

```{r}
#| eval: false
find 03_data/995_ldsc_inputs/04_ldscores/ -type f -name "*.ldscore.gz" > 03_data/995_ldsc_inputs/ldscore_filepaths.txt
```

# Load packages

```{r}
source(here::here("04_data_analysis/990_code_libraries/02_library-calls-for-renv.R"))
```

# Generate .ldcts files

```{r}
# Generate the ldcts
files <- readLines(here::here("03_data/995_ldsc_inputs/ldscore_filepaths.txt"))
# Remove the one percent files as they don't have a matching background
files <- files[!grepl("top-one-percent", files)]
# Save the directory location
directory <- unique(dirname(files))
directory <- paste0("/scratch/scw1329/gmbh/blood-brain-barrier-in-ad/", direcotry, "/")

# Now get the basename, sub until the first "." and get the unique strings
files <- basename(files)
files <- sub("\\..*$", "", files) |>
  unique()
# Sort files alphabetically
files <- sort(files)

# Gene list files start with "ldsc_" and background gene lists have 
# "background_genes"
background_files <- files[grepl("background_genes", files)]
celltype_files <- files[!files %in% background_files]

labels_background <- str_replace(background_files, "background_genes-ldsc_", "")
labels_celltypes <- str_replace(celltype_files, "ldsc_", "")
# Assert that these should be equal to make sure the order matches
assertthat::are_equal(labels_background, labels_celltypes)

# generate .ldcts file for ldscore regression
paste0(labels_celltypes, " ", directory, celltype_files, ".,", directory, background_files, ".") |> 
  writeLines(here::here("03_data/995_ldsc_inputs/celltype_markers.ldcts"))
```

