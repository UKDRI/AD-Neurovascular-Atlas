---
title: BBB in AD
author:
  - name: "Gabriel Mateus Bernardo Harrington"
    orcid: 0000-0001-6075-3619
    corresponding: true
    email: bernardo-harringtong@cardiff.ac.uk
    role:
      - investigation: lead
      - formal analysis: lead
      - software: lead
      - writing – original draft: equal
      - visualization: lead
      - data curation: lead
    affiliations: 
      - ref: cardiff
      - ref: dri
    degrees: 
      - PhD
  - name: Jimena Monzon Sandoval
    affiliations: 
      - ref: cardiff
      - ref: dri
    degrees: 
      - PhD
    #orcid: 0000-0002-7859-8394
    corresponding: false
    roles: []
  - name: Michal Rokicki
    affiliations: 
      - ref: cardiff
    roles: []
    degrees: 
      - PhD
  - name: Zameel Cader
    affiliations: 
      - ref: oxford
    roles: []
    degrees: 
      - PhD
  - name: Caleb Webber
    affiliations: 
      - ref: cardiff
      - ref: dri
    degrees: 
      - PhD
    #orcid: 0000-0002-7859-8394
    corresponding: false
    roles: []
affiliations:
  - id: cardiff
    name: Cardiff University
    city: Cardiff
    url: www.cardiff.ac.uk
  - id: dri
    name: UK Dementia Research Institue
    url: https://ukdri.ac.uk/
  - id: oxford
    name: Oxford University
    city: Oxford
    url: https://www.ox.ac.uk/
keywords:
  - Alzheimer's diesease
  - Blood brain barrier
abstract: |
  The blood brain barrier, it's important, probably in AD even
plain-language-summary: |
  Getting a more complete view of all the celltypes in the brain is good I guess
key-points:
  - A novel sample prep for isolating the neurovascular unit from post-mortem brain tissue reveals interesting stuff
  - Novel risk assocaitions
  - EndoMT, they're a thing in the brain, probably
date: last-modified
bibliography: references.bib
citation:
  container-title: Cell
number-sections: true
crossref:
  custom:
    - kind: float
      key: suppfig
      latex-env: suppfig
      reference-prefix: Figure S
      space-before-numbering: false
      latex-list-of-description: Supplementary Figure
    - kind: float
      key: supptbl
      latex-env: supptbl
      reference-prefix: Table S
      space-before-numbering: false
      latex-list-of-description: Supplementary Table
---

```{r}
#| label: purl setup
#| include: false
# purl setup script
knitr::purl(
  here::here("04_data_analysis/990_code_libraries/01_r-packages-used.qmd"),
  here::here("04_data_analysis/990_code_libraries/01_r-packages-used.R")
)
```

```{r}
#| label: load packages
#| include: false
source(here::here("04_data_analysis/990_code_libraries/02_library-calls-for-renv.R"))
```

```{r}
#| label: get donor metadata
donor_metadata <- readr::read_csv(here::here("03_data/999_data_for_publication/donor_meta_data.csv"))
```

Note that I'll add a skeleton of all the sections Cell outlines

## Summary

The neurovascular unit (NVU) is crucial for brain homeostasis and is implicated in Alzheimer's disease (AD) pathogenesis.
We developed a method to isolate the NVU from parenchymal tissue in post-mortem human brains, achieving over 90% vascular cell enrichment.
Using single-nuclei sequencing from 40 samples (20 control and 20 AD cases), we identified risk associations with AD in pericyte and perivascular fibroblast subtypes, as well as in activated microglia.
These cells have unique risk signatures linked to amyloid, suggesting a collaborative role in AD risk.
Additionally, we discovered EndoMT cells, transitioning from endothelial to mural cells, not previously documented in vascular atlases.
This study provides a valuable resource for understanding NVU composition and dynamics in AD, highlighting potential cellular targets for therapeutic intervention and offering new insights into the cellular interactions associated with amyloid and AD risk.

## Introduction

-   Role of BBB in AD
-   Prior vascular atlases (Yang), their methods, shortcomings and how our method addresses them

## Results

### Isolating the neurovascular unit

![(A) Neurovascular unit isolation method. (B)](05_figures/990_shared_figures/003_final_figures/figure1.png){#fig-method fig-alt="A multi-panel figure on our method for isolating the neurovascular unit, and a highlevel data summary. Panel A is a cartoon of the isolation method. Panel B and C are UMAP plots showing the cells from the vascular/parenchymal fractions and the celltype annotation respectively."}

-   Explain isolation (or refer to pre-print if it's ready?)
-   The quality/purity of the enrichment
-   The cohort details/summary?
-   Celltype annotation?
-   Compare method directly to Yang atlas paper

### Differential cell populations

- NOTE: I'll add this here but might be worth moving around to be with section on EndoMT
    - Also may need to update the figure number/panel reference if things move around

```{r}
#| label: get celltype label abbreviations
celltype_abbrev_df <- readr::read_tsv(here::here("05_figures/990_shared_figures/003_final_figures/001_data_for_plots/celltype_abbreviations.tsv"))
```

```{r}
#| label: get speckle celltype pop differences
# Read in data, add celltype abbreviations and add fraction label
cell_pop_diff_par <- readr::read_csv(here::here("03_data/990_processed_data/001_snrnaseq/10_cell_subtypes/speckle_level2_celltype_proportions_parenchymal.csv")) |>
  dplyr::rename(celltype = BaselineProp.clusters) |>
  dplyr::left_join(celltype_abbrev_df, by = join_by(celltype)) |>
  dplyr::mutate(fraction = "P")
# Do the same and rbind with parenchymal fraction
cell_pop_diff <- readr::read_csv(here::here("03_data/990_processed_data/001_snrnaseq/10_cell_subtypes/speckle_level2_celltype_proportions_vascular.csv")) |>
  dplyr::rename(celltype = BaselineProp.clusters) |>
  dplyr::left_join(celltype_abbrev_df, by = join_by(celltype)) |>
  dplyr::mutate(fraction = "V") |>
  rbind(cell_pop_diff_par)
# Filter to sig pop differences
cell_pop_diff_sig <- cell_pop_diff |>
  dplyr::filter(P.Value < 0.05) |>
  dplyr::mutate(across(where(is.numeric), \(x) round(x, digits = 3)))
```

We observed significant differences in the proportions of `{r} cell_pop_diff_sig$celltype_abbrev[1]` (p = `{r} cell_pop_diff_sig$P.Value[1]`, FDR = `{r} cell_pop_diff_sig$FDR[1]`), `{r} cell_pop_diff_sig$celltype_abbrev[2]` (p = `{r} cell_pop_diff_sig$P.Value[2]`, FDR = `{r} cell_pop_diff_sig$FDR[2]`), and `{r} cell_pop_diff_sig$celltype_abbrev[3]` (p = `{r} cell_pop_diff_sig$P.Value[3]`, FDR = `{r} cell_pop_diff_sig$FDR[3]`) between case and control group, with all 3 celltypes being lower in cases than controls (@fig-method (F).

### Risk section summary

-   TODO:
-   Expand on the level 1 T-cell stuff, most of the celltypes have t-cell/lymphocyte GO pathways

![(A) figure legend stuff](05_figures/990_shared_figures/003_final_figures/figure2.png){#fig-risk fig-alt="A multi-panel figure about Alzheimer's disease risk enrichment."}

### Identification of Risk Associations in Specific Cell Types

We sought to understand what celltype-specific AD risk associations would emerge with a fuller representation of celltypes in the brain.
Using single-nuclei sequencing data, we investigated the association of gene expression profiles in various celltypes with Alzheimer's disease (AD) risk.
Our analysis in the high-level celltypes identified significant risk associations after multiple testing correction in four celltypes: fibroblasts, pericytes, microglia and T-cells.
When looking at more details cell sub-types we identify activated microglia (microglia-A), pericyte-2, and perivascular-FB-2 being significantly associated with disease risk.

### MAGMA Analysis

To determine these associations, we employed Multi-marker Analysis of GenoMic Annotation (MAGMA) against the latest Bellenguez AD Genome-Wide Association Study (GWAS).[@bellenguez2022] 
We subset to control samples and identified celltype-specific marker genes using `FindAllMarkers` from the Seurat package.[@Seurat-2] Only genes that are detected in a minimum of 25% of cells in either of the two populations are considered and a minimum log fold change of 0.01 was used.
This function was used to apply a Wilcoxon Rank Sum test to compare each cluster against all other clusters identifying differentially expressed gene.
From this list of genes, the top ten percent of the total number of genes in the dataset which had the lowest p-values were selected as the celltype specific genes.

Microglia-A, which play a crucial role in immune response within the brain, exhibited a pronounced association with AD risk.
Pericyte-2, involved in blood-brain barrier maintenance and cerebral blood flow regulation, also showed significant associations.
Similarly, perivascular-FB-2, essential for the structural integrity of the blood-brain barrier and extracellular matrix composition, were identified as significantly associated with AD risk.

#### Conditional Analysis

We conducted conditional analysis to assess the independence of the risk signals from each celltype.
The results showed significant enrichment for each of the three cell types even when conditioned on the other two cell types, indicating that the observed signals are unique and not confounded by the other cell types.\<NOTE: refer to figure panel of conditional analysis here\>

#### Gene Ontology (GO) Enrichment Analysis

To further understand the biological implications of these associations, we performed Gene Ontology (GO) enrichment analysis on the significant genes identified by MAGMA for each of the aforementioned cell types.
The GO analysis revealed several enriched pathways, prominently featuring several amyloid-related processes.
The enrichment of genes involved in amyloid precursor protein (APP) processing, amyloid-beta (Aβ) formation, and amyloid plaque clearance was particularly notable.
This finding aligns with the well-established role of amyloid pathology in AD.
Additionally, for microglia-A and pericyte-2 cell types, significant GO terms related to T-cell and lymphocyte regulation were identified, suggesting an immune regulatory component in AD risk, especially given the significant risk association of T-cells in the level 1 analysis.

#### Protein-Protein Interaction (PPI) Networks

We constructed protein-protein interaction networks for the significant genes identified in each cell type.
The PPI networks all had significantly more interacting proteins then one would expect by change.
Subsequent Louvain clustering of these networks revealed modules associated with amyloid-related processes (via GO enrichment analysis) across all three cell types.
This suggests a coordinated risk association involving amyloid processing among microglia-A, pericyte-2, and perivascular-FB-2.

#### Mouse Ontology Data Analysis

To further validate our findings, we used mouse ontology data to investigate the functional implications of the significant genes.
We subset the database to terms with more than 10 and less than 200 genes and look for more overlap in a term than we would expect by chance.
For microglia-A, significant associations were found with the abnormal cell chemotaxis and hematoma terms.
Pericyte-2 showed significant associations with amyloidosis and tau protein deposits.
However, no significant associations were identified for perivascular-FB-2.

#### Cell-cell communication

To investigate the communication between these three celltypes we utilised `CellChat` and compared cases and controls.[@CellChat] We find communication in pericyte-2 and microglia-A via Transforming Growth Factor $\beta$ 1 (TGF$\beta1$) as a ligand in pericyte-2 to TGF$\beta$ Receptor (TGF$\beta$R) 1/2 and Activin A Receptor Type 1 (ACVR1) in microglia-A for cases but not controls, suggesting more activation of microglia by pericytes.\<NOTE: refs needed\>

-   NOTES on cellchat ligand receptor pairs:
    -   Pericyte-2 -\> Microglia-A (all in cases but not controls):
        -   PTN (Pleiotrophin) -\> NCL (Nucleolin) - roles in neuroprotection, neuronal growth and repair - modulating microglia survival/activation?
        -   IL34 -\> CSF1R (Colony Stimulating Factor 1 receptor) - similarly likely activating microglia more
        -   BMP6 (Bone morphogenetic protein 6) -\> BMPR1A/BMPR2/ACVR1 - again development/activation
    -   Microglia-A -\> Pericyte-2 (most present in both case and control)
        -   WNT5A -\> MCAM - cell adhesion, migration and polarity (BBB integrity?)
        -   TGFB1 -\> TGFRB1/2 + ACVR1 (**cases only**) - pericyte activation
        -   SPP1 -\> CD44 + ITGAV + ITGB5 + ITGB1 - cell adhesion/migration/survival (BBB/ injury response)
        -   PDGFB -\> PDGFRB - pericyte proliferation, survival and recruitment to blood vessels (response to vascular damage?)
        -   LGALS9 -\> CD44 - again, adhesion things
        -   GRN -\> SORT1 (**cases only**) - inflammatory things
        -   GAS6 -\> MERTK + AXL - cell survival (apoptosis?) - anti-inflammatory

#### Interpretation

The identification of these specific cell types and the enrichment of amyloid-related processes underscore the complex interplay between various cellular components in the brain and AD pathology.
Microglia-A, pericyte-2, and perivascular-FB-2 may contribute to disease mechanisms through their roles in immune response, vascular integrity, and amyloid processing, respectively.
The independence of these signals, as shown by conditional analysis, highlights the unique contributions of each cell type.
Additionally, the PPI network analysis suggests a coordinated risk association involving amyloid-related processes across these cell types.
Mouse ontology data further supports these findings, particularly highlighting the roles of microglia-A and pericyte-2 cells in AD-related pathologies.

These findings provide new insights into potential cellular targets for therapeutic intervention in Alzheimer's disease.

### DEGs

-   ex-neuron 5 - interesting DEGs and sig proportion difference

## Discussion

## Acknowledgments

## Author contributions

## Declaration of interests

## Figure titles and legends

## Tables with title and legends

## STAR Methods

Link to info on this here: <https://www.cell.com/star-authors-guide>

And a pdf guide [here](https://www.cell.com/pb-assets/journals/research/cell/methods/Methods_Guide_Cell-1678470557763.pdf)

-   Plan to make the code available on GitHub and make a docker image with the R environment for all the downstream processing - The seurat object from scflow could be included in this image - This could go on ADDI as well?
-   Raw data will go on GEO I guess

### Key resoures table

```{r}
#| label: tbl-key-resources
#| tbl-cap: Key resources table
key_resources <- read_excel(here::here("03_data/999_data_for_publication/key_resources_table.xlsx"))

gt::gt(key_resources)
```

### Resource availability

#### Lead contact

Further information and requests for resources and reagents should be directed to and will be fulfilled by the lead contact, `name here` (`email here`).

#### Materials availability

No unique reagents were generated for this study.

#### Data and code availability

-   All raw data are available in the GEO database under the accession number GEO:
-   The Seurat object generated from the scFlow pipeline is included in the Docker image with the R environment used for analysis here:
-   All original code has been deposited at Zenodo and is publicly available as of the date of publication. DOIs are listed in the key resources table.

### Experimental model and study participant details

#### Post-mortem tissue donors

```{r}
n_males <- sum(donor_metadata$sex == "M")
n_females <- sum(donor_metadata$sex == "F")
median_age <- median(donor_metadata$age)
age_range <- range(donor_metadata$age)
```

Post-mortem pre-frontal cortex from 20 controls and 20 AD brain donors were collected from `brain bank here` under `ethics details here`.
The clinicopathological parameters were collected and summarized in @supptbl-donor-metadata, including gender, age, diagnosis, APOE status, ethnicity and Braak stage.
3 donors where excluded in QC and of the remaining `{r} nrow(donor_metadata)` donors, `{r} n_females` were female and `{r} n_males` were male with a median age of `{r} median_age` (range `{r} age_range[1]`-`{r} age_range[2]`).
Sex and age were included as a covariates in pseudobulk differential gene expression analysis.

### Method details

#### Sample prep/neurovascular unit isolation

#### RNA sequencing

### Quantification and statistical analysis

#### Data Processing

The raw sequencing data was processed using CellRanger (version 7.1.0, 10X Genomics), which performed initial alignment, filtering, barcode counting, and UMI counting.
An updated reference genome (Ensembl version 109 and Gencode version 43 annotations for GRCh38) was generated for use with CellRanger.
The resulting gene-barcode matrices were then further processed using the scFlow pipeline implemented in Nextflow.[@khozoie2021 ; @ditommaso2017]

#### Quality Control

The processed data were read into R (version 4.4.0) using the Seurat package (version 5.1.0).[@base; @Seurat] 
In addition to the filtering performed by scFlow, cells with low feature/RNA counts were filtered out (between \<300 & \<7500 for features and \>1000 for RNA), and donors with an insufficient number of high-quality cells were excluded from further analysis, resulting in 3 donors (both fractions), and the vascular fraction from 1 addition donor being excluded.

#### Clustering

A standard Seurat workflow was followed including normalisation, finding variable features, scaling and PCA.
For the UMAP 35 dimensions and a resolution of 0.6 was used.

#### Cell Type Annotation

Cell types were annotated based on canonical marker genes identified from the literature, @yang2022 in particular.
The expression levels of these marker genes were used to classify cells into distinct level 1 cell types.
These higher level celltypes were then subclustered with 20 dimensions and a resolution of 0.4 to identify level 2 cell subtypes.
This annotation process was validated by comparing the identified cell types to known cell type distributions in similar datasets.

#### Differential cell populations

To analyse differences in cell type proportions between case and control groups, we utilized the propeller function from the speckle R package (version 1.4.0) on the vascular and parenchymal fractions separately.[@speckle] 
This method employs a robust linear modelling framework to test for significant differences in cell type proportions across experimental conditions, while accounting for the compositional nature of the data and potential variability between samples.

#### Pseudobulk differential gene expression

## Supplemental information titles and legends

::: {#supptbl-donor-metadata}

```{r}
donor_metadata |>
  dplyr::select(donor_ID, sex, age, diagnosis, Braak_Tangle, pH_cerebellum, Ethnicity, Brain_weight, diagnosis_details, apoe_status) |>
  janitor::clean_names() |>
  dplyr::rename(pH_cerebellum = p_h_cerebellum) |>
  gt::gt()
```

Clinical Information. Clinical characteristics of the cohort and samples included in the multi-omics analysis.
:::

::: {#supptbl-r-packages}
```{r}
# Get session information
session_info <- sessioninfo::session_info()

# Extract package information
package_info <- session_info$packages %>%
  dplyr::select(package, loadedversion, source) %>%
  dplyr::arrange(package)

# Convert to a data frame
package_df <- as.data.frame(package_info)
# Print table
package_df |>
  dplyr::group_by(source) |>
  gt::gt()
```

R packages used

:::
## References
